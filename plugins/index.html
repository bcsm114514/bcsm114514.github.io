<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blazemark æ’ä»¶æ„å»ºæŒ‡å— - Blazemark Blog</title>
  <link rel="stylesheet" href="/static/css/style.css" />
  <script defer src="/static/js/theme.js"></script>
</head>
<body class="theme-light">
  <header class="site-header">
    <div class="header-inner">
      <div class="site-branding">
        <h1 class="site-title"><a href="https://bcsm114514.github.io">Blazemark Blog</a></h1>
        
        <p class="site-subtitle">ç”¨ Python æé€Ÿç”Ÿæˆé™æ€åšå®¢</p>
        
      </div>
      <nav class="site-nav">
        <ul>
        
          <li><a href="/">é¦–é¡µ</a></li>
        
          <li><a href="/tag/">æ ‡ç­¾</a></li>
        
          <li><a href="/category/">åˆ†ç±»</a></li>
        
          <li><a href="/archives/">å½’æ¡£</a></li>
        
        </ul>
      </nav>
      <button class="theme-toggle" aria-label="åˆ‡æ¢ä¸»é¢˜">ğŸŒ“</button>
    </div>
    
  </header>

  <main class="site-main">
    <div class="content-inner">
      
  <article class="post-full">
    <h1 class="post-full-title">Blazemark æ’ä»¶æ„å»ºæŒ‡å—</h1>
    <div class="post-full-meta">
      <time>2025-10-02</time>
      
        <span class="tags">
          
            <a href="/tag/Blazemark">Blazemark</a>
          
        </span>
        <span class="category">
          
        </span>        
      
    </div>
    <div class="post-content">
      <h1>ğŸ“¦ Blazemark æ’ä»¶æ„å»ºæŒ‡å—</h1>
<p>Blazemark æ”¯æŒæ’ä»¶æ‰©å±•åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ç¼–å†™æ’ä»¶å¯¹ç”Ÿæˆæµç¨‹è¿›è¡Œä¿®æ”¹ï¼Œä¾‹å¦‚è‡ªåŠ¨åŠ æ ‡ç­¾ã€ä¿®æ”¹æ–‡ç« å†…å®¹ã€æ·»åŠ é¢å¤–å­—æ®µç­‰ã€‚</p>
<hr />
<h2>ğŸ”¹ 1. æ’ä»¶åŸºç¡€ç»“æ„</h2>
<p>Blazemark çš„æ’ä»¶åŸºç±»æ˜¯ï¼š</p>
<pre><code class="language-python">class Plugin:
    def on_config(self, config: dict) -&gt; dict:
        return config

    def on_post(self, post: &quot;Post&quot;) -&gt; &quot;Post&quot;:
        return post

    def on_build(self, site: dict) -&gt; dict:
        return site
</code></pre>
<p>ä¸‰ä¸ªå¯é€‰çš„é’©å­æ–¹æ³•ï¼š</p>
<ul>
<li>
<pre><code>on_config(config)
</code></pre>
<p>åœ¨åŠ è½½é…ç½®åæ‰§è¡Œï¼Œå¯ä¿®æ”¹ configã€‚</p>
</li>
<li>
<pre><code>on_post(post)
</code></pre>
<p>åœ¨å¤„ç†æ¯ç¯‡æ–‡ç« æ—¶æ‰§è¡Œï¼Œå¯ä¿®æ”¹æ–‡ç« å¯¹è±¡ã€‚</p>
</li>
<li>
<pre><code>on_build(site)
</code></pre>
<p>åœ¨æ•´ä¸ªç½‘ç«™ç”Ÿæˆåæ‰§è¡Œï¼Œå¯ä¿®æ”¹ site å¯¹è±¡ã€‚</p>
</li>
</ul>
<hr />
<h2>ğŸ”¹ 2. æ•°æ®ç»“æ„</h2>
<p>Post å¯¹è±¡</p>
<pre><code class="language-python">@dataclass
class Post:
    src: str       # æºæ–‡ä»¶è·¯å¾„
    slug: str      # æ–‡ç«  slug
    title: str     # æ ‡é¢˜
    date: str      # æ—¥æœŸ
    content: str   # HTML å†…å®¹
    meta: dict     # å…ƒæ•°æ®ï¼ˆä» Markdown frontmatter è¯»å–ï¼‰
    url: str = &quot;&quot;  # æœ€ç»ˆç”Ÿæˆçš„é“¾æ¥
</code></pre>
<p>Site å¯¹è±¡</p>
<pre><code class="language-python">{
    &quot;config&quot;: {...},   # ç«™ç‚¹é…ç½®
    &quot;posts&quot;: [Post],   # å…¨éƒ¨æ–‡ç« 
    &quot;pages&quot;: [Post],   # é¢å¤–é¡µé¢
}
</code></pre>
<hr />
<h2>ğŸ”¹ 3. æ’ä»¶ç¤ºä¾‹</h2>
<p>ç¤ºä¾‹ 1ï¼šè‡ªåŠ¨ç”Ÿæˆrss.xmlä¸sitemap.xml</p>
<pre><code class="language-python">import os
from pathlib import Path
from datetime import datetime
from xml.sax.saxutils import escape

from blazemark import Plugin
from urllib.parse import quote

class RSSAndSitemapAdvancedPlugin(Plugin):
    def on_build_finished(self, generator, data=None):
        output_dir = getattr(generator, &quot;OUTPUT_DIR&quot;, Path(&quot;public&quot;))
        site = generator.config
        site_url = site.get(&quot;url&quot;, &quot;http://example.com&quot;).rstrip(&quot;/&quot;)

        posts = generator.get_posts(include_drafts=False)

        # -------- ç”Ÿæˆ RSS.xml --------
        rss_items = []
        for post in posts:
            url = f&quot;{site_url}{post['url']}&quot;
            title = escape(post['title'])
            description = escape(post.get('description', post.get('content', '')[:200]))
            pub_date = post.get('date', datetime.now().strftime(&quot;%a, %d %b %Y %H:%M:%S +0000&quot;))
            categories = post.get('category', [])
            if isinstance(categories, str):
                categories = [categories]
            tags = post.get('tags', [])
            if isinstance(tags, str):
                tags = [tags]

            category_tags = &quot;&quot;.join([f&quot;&lt;category&gt;{escape(c)}&lt;/category&gt;&quot; for c in categories+tags])
            rss_items.append(f&quot;&quot;&quot;
    &lt;item&gt;
      &lt;title&gt;{title}&lt;/title&gt;
      &lt;link&gt;{url}&lt;/link&gt;
      &lt;description&gt;{description}&lt;/description&gt;
      &lt;pubDate&gt;{pub_date}&lt;/pubDate&gt;
      {category_tags}
      &lt;guid&gt;{url}&lt;/guid&gt;
    &lt;/item&gt;
            &quot;&quot;&quot;.strip())

        rss_xml = f&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;rss version=&quot;2.0&quot;&gt;
&lt;channel&gt;
  &lt;title&gt;{escape(site.get('title', 'Blazemark Blog'))}&lt;/title&gt;
  &lt;link&gt;{site_url}/&lt;/link&gt;
  &lt;description&gt;{escape(site.get('description', ''))}&lt;/description&gt;
  {''.join(rss_items)}
&lt;/channel&gt;
&lt;/rss&gt;
        &quot;&quot;&quot;

        Path(output_dir).mkdir(parents=True, exist_ok=True)
        with open(Path(output_dir)/&quot;rss.xml&quot;, &quot;w&quot;, encoding=&quot;utf-8&quot;) as f:
            f.write(rss_xml)
        print(&quot;[æ’ä»¶] RSS.xml å·²ç”Ÿæˆ&quot;)

        # -------- ç”Ÿæˆ Sitemap.xml --------
        urls = set()
        for post in posts:
            urls.add(post['url'])

        # æ ‡ç­¾é¡µé¢
        all_tags = set()
        all_categories = set()
        for post in posts:
            tags = post.get('tags', [])
            if isinstance(tags, str):
                tags = [tags]
            all_tags.update(tags)
            categories = post.get('category', [])
            if isinstance(categories, str):
                categories = [categories]
            all_categories.update(categories)

        for tag in all_tags:
            urls.add(f&quot;/tag/{quote(tag)}/&quot;)
        for cat in all_categories:
            urls.add(f&quot;/category/{quote(cat)}/&quot;)

        sitemap_items = []
        for url in urls:
            full_url = f&quot;{site_url}{url}&quot;
            lastmod = datetime.now().strftime(&quot;%Y-%m-%d&quot;)
            sitemap_items.append(f&quot;&quot;&quot;
  &lt;url&gt;
    &lt;loc&gt;{full_url}&lt;/loc&gt;
    &lt;lastmod&gt;{lastmod}&lt;/lastmod&gt;
    &lt;changefreq&gt;weekly&lt;/changefreq&gt;
    &lt;priority&gt;0.8&lt;/priority&gt;
  &lt;/url&gt;
            &quot;&quot;&quot;.strip())

        sitemap_xml = f&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;urlset xmlns=&quot;http://www.sitemaps.org/schemas/sitemap/0.9&quot;&gt;
{''.join(sitemap_items)}
&lt;/urlset&gt;
        &quot;&quot;&quot;

        with open(Path(output_dir)/&quot;sitemap.xml&quot;, &quot;w&quot;, encoding=&quot;utf-8&quot;) as f:
            f.write(sitemap_xml)
        print(&quot;[æ’ä»¶] Sitemap.xml å·²ç”Ÿæˆ&quot;)

# å®ä¾‹åŒ–æ’ä»¶
plugin = RSSAndSitemapAdvancedPlugin()
</code></pre>
<p>ç¤ºä¾‹ 2ï¼šå­—æ•°ç»Ÿè®¡</p>
<pre><code class="language-python">from blazemark import Plugin, Post
import re

class WordCountPlugin(Plugin):
    def count_words(self, text: str) -&gt; int:
        &quot;&quot;&quot;ç»Ÿè®¡æ–‡æœ¬ä¸­çš„ä¸­æ–‡æ±‰å­— + è‹±æ–‡å•è¯&quot;&quot;&quot;
        cn_count = len(re.findall(r'[\u4e00-\u9fff]', text))
        en_count = len(re.findall(r'\b[a-zA-Z0-9]+\b', text))
        return cn_count + en_count

    def on_after_render(self, post: Post, html_content: str):
        # ç»Ÿè®¡ Markdown åŸæ–‡
        words = self.count_words(post.content)
        footer = f&quot;&lt;p&gt;&lt;em&gt;å­—æ•°ç»Ÿè®¡: {words} å­—&lt;/em&gt;&lt;/p&gt;&quot;
        # æ’å…¥æ–‡ç« æœ«å°¾
        html_content = html_content.replace(&quot;&lt;/article&gt;&quot;, footer + &quot;&lt;/article&gt;&quot;)
        return html_content

plugin = WordCountPlugin()
</code></pre>
<hr />
<h2>ğŸ”¹ 4. æ’ä»¶å¼€å‘æ³¨æ„äº‹é¡¹</h2>
<p><strong>ä¿æŒçº¯å‡½æ•°å¼ä¿®æ”¹</strong>ï¼šæ¯ä¸ªé’©å­åº”è¯¥è¿”å›ä¿®æ”¹åçš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯ç›´æ¥æ“ä½œå…¨å±€å˜é‡ã€‚</p>
<p><strong>é¿å…é‡åå†²çª</strong>ï¼šæ’ä»¶ç±»åä¿æŒå”¯ä¸€ã€‚</p>
<p><strong>è°ƒè¯•å»ºè®®</strong>ï¼šåœ¨æ’ä»¶ä¸­å¯ä»¥ print() è¾“å‡ºè°ƒè¯•ä¿¡æ¯ã€‚</p>
<p><strong>å®‰å…¨æ€§</strong>ï¼šæ’ä»¶å¯ä»¥ä¿®æ”¹æ‰€æœ‰æ•°æ®ï¼Œè¯·é¿å…æ‰§è¡Œå±é™©æ“ä½œã€‚</p>

    </div>
    <div class="post-footer-nav">
      
      
    </div>
  <p><em>å­—æ•°ç»Ÿè®¡: 773 å­—</em></p></article>

  <!-- å¼•å…¥ Prism.js -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-markup.min.js"></script>

    </div>
  </main>

  <footer class="site-footer">
    <div class="footer-inner">
      <p>Â© 2025 Blazemark Blog. All Rights Reserved.</p>
      <p>
        <a href="/rss.xml">RSS</a> |
        <a href="/sitemap.xml">Sitemap</a>
      </p>
      <p>Powered by blazemark / theme: BlazeMark</p>
    </div>
  </footer>
</body>
</html>